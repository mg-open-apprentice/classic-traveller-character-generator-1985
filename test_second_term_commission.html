<!DOCTYPE html>
<html>
<head>
    <title>Second Term Commission Test</title>
    <style>
        body { font-family: monospace; background: black; color: green; padding: 20px; }
        button { padding: 10px; margin: 5px; background: #003300; color: #0ff; border: 1px solid #0ff; }
        .hidden { display: none; }
        .disabled { opacity: 0.5; cursor: not-allowed; }
        #test-results { margin-top: 20px; padding: 10px; border: 1px solid #0ff; }
    </style>
</head>
<body>
    <h1>Second Term Commission Button Test</h1>
    
    <h2>Test Scenarios:</h2>
    <button onclick="testUncommissionedReady()">Test: Uncommissioned + Ready for Commission</button>
    <button onclick="testUncommissionedNotReady()">Test: Uncommissioned + Not Ready</button>
    <button onclick="testCommissioned()">Test: Already Commissioned</button>
    <button onclick="testScouts()">Test: Scouts (No Commission)</button>
    
    <h2>Mock UI Elements:</h2>
    <div id="actions-panel" style="border: 1px solid #0ff; padding: 10px; margin: 10px;">
        <h3>Actions Panel</h3>
        <button id="commission-action-btn" class="hidden">
            <div>Commission</div>
            <div id="commission-action-prob">-</div>
        </button>
    </div>
    
    <div style="border: 1px solid #0ff; padding: 10px; margin: 10px;">
        <h3>Left Panel Buttons</h3>
        <button id="left-commission-btn">Commission</button>
        <button id="left-promotion-btn">Promotion</button>
    </div>
    
    <div id="test-results">
        <h3>Test Results:</h3>
        <div id="results-content">Click a test button above to run tests</div>
    </div>

    <script>
        // Mock functions from the main script
        let currentCharacter = null;
        
        function enableButton(buttonId) {
            const btn = document.getElementById(buttonId);
            if (btn) {
                btn.classList.remove('disabled');
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            }
        }
        
        function disableButton(buttonId) {
            const btn = document.getElementById(buttonId);
            if (btn) {
                btn.classList.add('disabled');
                btn.disabled = true;
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            }
        }
        
        function isScoutsOrOthers(character) {
            return character.career === 'Scouts' || character.career === 'Others';
        }
        
        // The fixed functions from our script
        function resetTermButtons(character) {
            const termButtons = ['left-commission-btn', 'left-promotion-btn'];
            
            // Add commission button only if not already commissioned
            let commissionIncluded = false;
            if (!character || !character.commissioned) {
                commissionIncluded = true;
                const btn = document.getElementById('left-commission-btn');
                if (btn) btn.style.display = 'block';
            } else {
                const btn = document.getElementById('left-commission-btn');
                if (btn) btn.style.display = 'none';
            }
            
            logResult(`resetTermButtons: Commission button ${commissionIncluded ? 'included' : 'excluded'}`);
        }
        
        function setButtonStatesForNewTerm(character) {
            const isScoutsOrOthers = character.career === 'Scouts' || character.career === 'Others';
            
            // Commission button logic
            const commissionBtn = document.getElementById('left-commission-btn');
            if (commissionBtn && !character.commissioned) {
                if (character.rdy_for_commission_check && !isScoutsOrOthers) {
                    enableButton('left-commission-btn');
                    logResult(`Commission button: ENABLED (ready and not commissioned)`);
                } else {
                    disableButton('left-commission-btn');
                    logResult(`Commission button: DISABLED (not ready or scouts/others)`);
                }
            } else if (commissionBtn && character.commissioned) {
                commissionBtn.style.display = 'none';
                logResult(`Commission button: HIDDEN (already commissioned)`);
            }
            
            // Promotion button logic
            const promotionBtn = document.getElementById('left-promotion-btn');
            if (promotionBtn) {
                if (character.rdy_for_promotion_check && !isScoutsOrOthers) {
                    enableButton('left-promotion-btn');
                    logResult(`Promotion button: ENABLED`);
                } else {
                    disableButton('left-promotion-btn');
                    logResult(`Promotion button: DISABLED`);
                }
            }
        }
        
        function showCommissionButton() {
            if (!currentCharacter) {
                logResult(`showCommissionButton: ERROR - No current character`);
                return;
            }
            
            const bigBtn = document.getElementById('commission-action-btn');
            if (bigBtn) {
                bigBtn.style.display = 'block';
                bigBtn.classList.remove('hidden');
                logResult(`showCommissionButton: Big commission button shown`);
            } else {
                logResult(`showCommissionButton: ERROR - Commission action button not found`);
            }
        }
        
        function showActionsPanel() {
            const panel = document.getElementById('actions-panel');
            if (panel) {
                panel.style.display = 'block';
                logResult(`showActionsPanel: Actions panel shown`);
            }
        }
        
        function testLogic(character) {
            currentCharacter = character;
            logResult(`\\n=== Testing with character: ${JSON.stringify(character)} ===`);
            
            // Test the sequence that happens in new term
            resetTermButtons(character);
            setButtonStatesForNewTerm(character);
            
            // Test commission button show logic
            if (character.rdy_for_commission_check && !isScoutsOrOthers(character) && !character.commissioned) {
                showActionsPanel();
                showCommissionButton();
                logResult(`Main logic: Should show commission button - YES`);
            } else {
                logResult(`Main logic: Should show commission button - NO`);
            }
        }
        
        function logResult(message) {
            const results = document.getElementById('results-content');
            results.innerHTML += message + '<br>';
        }
        
        function clearResults() {
            document.getElementById('results-content').innerHTML = '';
        }
        
        // Test scenarios
        function testUncommissionedReady() {
            clearResults();
            testLogic({
                name: "Test Character",
                career: "Army",
                commissioned: false,
                rdy_for_commission_check: true,
                rdy_for_promotion_check: false,
                terms_served: 1
            });
        }
        
        function testUncommissionedNotReady() {
            clearResults();
            testLogic({
                name: "Test Character",
                career: "Army", 
                commissioned: false,
                rdy_for_commission_check: false,
                rdy_for_promotion_check: false,
                terms_served: 1
            });
        }
        
        function testCommissioned() {
            clearResults();
            testLogic({
                name: "Test Character",
                career: "Army",
                commissioned: true,
                rdy_for_commission_check: false,
                rdy_for_promotion_check: true,
                terms_served: 1,
                rank: 1
            });
        }
        
        function testScouts() {
            clearResults();
            testLogic({
                name: "Test Character",
                career: "Scouts",
                commissioned: false,
                rdy_for_commission_check: true,
                rdy_for_promotion_check: false,
                terms_served: 1
            });
        }
    </script>
</body>
</html>